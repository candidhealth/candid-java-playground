# GraalVM Native Image configuration for gRPC + Netty compatibility
#
# This configuration is critical for making gRPC work with GraalVM native-image.
# The main challenge is Netty's initialization timing - some classes must be
# initialized at runtime rather than build time to avoid issues with:
# - Event loops
# - Native libraries
# - Platform-specific code
#
# References:
# - https://github.com/grpc/grpc-java/issues/10781
# - https://www.graalvm.org/latest/reference-manual/native-image/metadata/

# Initialize Netty and gRPC at runtime (critical for compatibility)
# Netty uses platform-specific code and native libraries that must be
# loaded at runtime, not build time
# Initialize Jackson, Logback, and logstash encoder at build time for better startup performance
Args = --initialize-at-run-time=io.netty \
       --initialize-at-run-time=io.grpc.netty \
       --initialize-at-build-time=com.fasterxml.jackson \
       --initialize-at-build-time=ch.qos.logback \
       --initialize-at-build-time=net.logstash.logback \
       --initialize-at-build-time=org.slf4j \
       -H:+ReportExceptionStackTraces \
       -H:+AddAllCharsets \
       --enable-url-protocols=http,https \
       --enable-http \
       -O3 \
       -H:+ReportUnsupportedElementsAtRuntime
